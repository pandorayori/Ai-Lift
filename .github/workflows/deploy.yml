- name: Deploy on ECS
  env:
    HOST: ${{ secrets.ECS_HOST }}
    USER: ${{ secrets.ECS_USER }}
    APP_DIR: /root/apps/Ai-Lift
  run: |
    ssh -o StrictHostKeyChecking=no ${USER}@${HOST} << 'EOF'
      set -e

      cd /root/apps/Ai-Lift

      # 1) 更新代码（如果你是 git clone 在服务器上，就用 pull；否则你之前用 scp/rsync 就按你的方式）
      git fetch --all
      git reset --hard origin/main

      # 2) 后端（api）
      cd /root/apps/Ai-Lift/api
      npm ci --omit=dev || npm install
      pm2 delete ai-lift-api || true
      pm2 start index.js --name ai-lift-api
      pm2 save

      # 3) 前端（frontend）
      cd /root/apps/Ai-Lift/frontend
      npm ci || npm install
      npm run build

      echo "✅ Deploy done"
    EOF
